<%@ page session="true" 
language="java" 
contentType="text/html; charset=UTF-8" 
import="java.sql.*" %> 
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/sql" prefix="sql" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/functions" prefix="fn" %>
<%@ taglib uri="http://it.unipv.bmilab.uploadtags"      prefix="upload" %>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------------------------ CONTROLLO DEI PERMESSI DI GOV ------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>


<c:set var="auth_cod_ruolo" value="2"/>
<c:set var="auth_page" value="home_gov.jsp"/>
<c:set var="auth_messaggio" value="L'accesso a questa pagina e' riservato a chi svolge il ruolo di Agenzia Governativa"/>

<%@ include file="auth.jspf"%>

<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%----------------------------------------------- LAYOUT TOP --------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>


<%@ include file="top.jspf"%>

<sql:query var="dettagli">
  select  c.user_cert, c.cf, c.sesso, c.nome, c.cognome, c.data_nascita, c.n_albo, c.ubicazione, u.telefono, u.mail, u.attivo
    from CERT c, UTENTE_RUOLO u
    where  c.user_cert=u.username
  and  u.username LIKE ?
<sql:param value="${param.user}"/>
</sql:query>


<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%--------------------------------------------- COMANDO INDIETRO ----------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
 
<td align="right"  width="60">
<c:if test="${dettagli.rows[0].attivo==false}">
       <a href="elenco_cert_sospesi.jsp"> 
            <img style="width:60px;height:60px" src="indietro.png">
       </a>
</c:if>

<c:if test="${dettagli.rows[0].attivo==true}">
       <a href="elenco_cert.jsp"> 
            <img style="width:60px;height:60px" src="indietro.png">
       </a>
</c:if>
</td>

<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%----------------------------------------------- LAYOUT MID --------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>


<%@ include file="middle.jspf"%>


<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------- ESTRAZIONE PRATICHE CONCLUSE CON SUCCESSO DEL CERT DAL DB -------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

  <sql:query var="rset_elencocert_praticheterm_succ">
        select S.id_scheda
        from SCHEDA_PROD S 
        where S.fine_prat IS NOT NULL and
              S.stato=1 and
              S.user_cert LIKE ?
   <sql:param value="${param.user}"/>
    </sql:query>

<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------- ESTRAZIONE DI TUTTE LE PRATICHE COCNLUSE DI OGNI CERT DAL DB ----------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>


  <sql:query var="rset_elencocert_praticheterm">
        select S.id_scheda
        from SCHEDA_PROD S 
        where S.fine_prat IS NOT NULL and
              S.user_cert LIKE ?
   <sql:param value="${param.user}"/>
    </sql:query>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- CALCOLO PERCENTUALE ---------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

<c:set var="n_p_succ" value="${rset_elencocert_praticheterm_succ.rowCount}"/>
<c:set var="n_p_concluse" value="${rset_elencocert_praticheterm.rowCount}"/>

<c:choose>
 <c:when test="${n_p_concluse>0}">
<c:set var="percentuale" value="${(n_p_succ/n_p_concluse)*100}"/>
 </c:when>
 <c:otherwise>
  <c:set var="percentuale" value="0"/>
</c:otherwise>
</c:choose>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- TITOLO TABELLA ---------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

<TABLE  cellspacing="0" border="0" bgcolor="#bbccdc"
   width="100%" height="85%" bordercolor="#41140E"  >


<tr>
  <td   align="center" width="60%" style="padding: 0px;border-left-width: 3px ">
     <table width="100%" height="100%" bordercolor="bbccdc" >
      <tbody>
        <tr  height="10%" >
          <td colspan="3" > &nbsp; </td>
         </tr>
         <tr >
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- STAMPA NOME E COGNOME -------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

           <td width="10%"></td>
           <td style="font-size:23px; font-family:arial">
           <p style="font-weight: bold;color:#526579;">&nbsp ${dettagli.rows[0].nome} ${dettagli.rows[0].cognome} 
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- STAMPA VALUTAZIONE IN STELLE IN BASE ALLA PERCENTUALE -----------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

                 <c:if test="${percentuale>10 }"><img title="${percentuale}%" width="15" height="15"  src="stella_gialla.png"/>
                 <c:if test="${percentuale>30 }"><img title="${percentuale}%" width="15" height="15"  src="stella_gialla.png"/>
                 <c:if test="${percentuale>50 }"><img title="${percentuale}%" width="15" height="15"  src="stella_gialla.png"/>
                 <c:if test="${percentuale>70 }"><img title="${percentuale}%" width="15" height="15"  src="stella_gialla.png"/>
                 <c:if test="${percentuale>90 }"><img title="${percentuale}%" width="15" height="15"  src="stella_gialla.png"/>
                 </c:if>
                 </c:if>
                 </c:if>
                 </c:if>
                 </c:if>
                </br> 
            </p>
     
   
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- TABELLA ---------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

        <table border="1" cellspacing="0" cellpadding="3" bordercolor="bbccdc">    </td>
        </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">ID: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].user_cert} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">CODICE FISCALE: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].cf} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">SESSO: </font></td>
                <td align="center"bgcolor="white"> ${dettagli.rows[0].sesso}</td>
            </tr>
            <tr>
                <td align="left" width="15%" height="35%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">NUMERO ALBO: </font></td>
                <td align="center" height="35%" bgcolor="white"> ${dettagli.rows[0].n_albo} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">DATA DI NASCITA: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].data_nascita} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">UBICAZIONE: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].ubicazione} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">MAIL: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].mail} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">TELEFONO: </font></td>
                <td align="center" bgcolor="white"> ${dettagli.rows[0].telefono} </td>
            </tr>
            <tr>
                <td align="left" width="15%" height="22%" bgcolor="#007171">
                    <font color="#9ad6d6" face="Arial">STATO: </font></td>
                <td align="center" bgcolor="white">  
                    <c:if test="${dettagli.rows[0].attivo==false}">NON ATTIVO</c:if>
                    <c:if test="${dettagli.rows[0].attivo==true}">ATTIVO</c:if></td>
            </tr>
        </table>
<br/><br/>
<table border="0">
    <tr>
        <td>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------- CONTROLLO SULLO STATO DEL CERT: SE SARA' SOSPESO APPARIRA' IL COMANDO PER RIABILITARLO -------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

            <c:if test="${dettagli.rows[0].attivo == false }">
                <form method="post" action="riabilitazione.jsp">
                    <input type="hidden" name="username" value="${dettagli.rows[0].user_cert}"/>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------- BUTTON RIABILITA ------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

                    <button style="border-color:#007171;background-color:#009c9c;width:230px;height:40px;">
                        <b style="font-size:17px;color:#eaf0f0;font-family:Arial;">RIABILITA CERT</b>
                    </button>
                </form>
            </c:if>
        </td>
    </tr>
</table>
</tr>
<tr height="20%">
    <td >&nbsp;</td>
</tr>
</tbody>
</table>
</td>  



</tr>
</TABLE>



                  

                                
                         
 


<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%------------------------------------------------- LAYOUT BOT ------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>
<%-------------------------------------------------------------------------------------------------------------%>

<%@ include file="bottom.jspf"%>